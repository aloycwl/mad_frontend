<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://aloycwl.github.io/js/cdn/jquery.min.js"></script>
<div id="container"></div>
<br /><br />
<p id="traits"></p>
<script>
  var Nose = ['Nose 1', 'Nose 2'],
    Mouth = ['Mouth 1', 'Mouth 2'],
    Body = ['Body 1', 'Body 2'],
    Face = ['Face 1'],
    Hat = [
      'Hat 1',
      'Hat 2',
      'Hat 3',
      'Hat 4',
      'Hat 5',
      'Hat 6',
      'Hat 7',
      'Hat 8',
      'Hat 9',
      'Hat 10',
    ],
    Eye = ['Eye 1', 'Eye 2'],
    Head = [
      'Head 1',
      'Head 2',
      'Head 3',
      'Head 4',
      'Head 5',
      'Head 6',
      'Head 7',
      'Head 8',
      'Head 9',
      'Head 10',
    ],
    Ear = ['Ear 1', 'Ear 2'],
    Background = [
      'Background 1',
      'Background 2',
      'Background 3',
      'Background 4',
      'Background 5',
      'Background 6',
      'Background 7',
      'Background 8',
      'Background 9',
      'Background 10',
    ],
    s = 350,
    cnt = 0;

  async function dd(s1, s2, s3, s4) {
    r = ran(s3.length);
    if (r + s2 <= s3.length) {
      txt += `{"trait_type":"${s1}","value":"${s3[r]}"},`;
      img = new Image();
      img.src = `https://aloycwl.github.io/mad_frontend/ape.png`;
      return new Promise((resolve) => {
        img.onload = function () {
          cd.drawImage(img, r * s, s4 * s, s, s, 0, 0, 350, 350);
          resolve();
        };
      });
    }
  }
  async function load() {
    $('#container').append(
      `<canvas id="can${cnt}"width="350"height="350"></canvas>`
    );
    (c = document.getElementById(`can${cnt}`)),
      (cd = c.getContext('2d')),
      cd.clearRect(0, 0, 350, 350);
    //$('#traits').html(``);
    txt = '{"attributes":[';
    await dd('Background', 0, Background, 7);
    await dd('Face', 0, Face, 6);
    await dd('Body', 0, Body, 0);
    await dd('Head', 0, Head, 3);
    await dd('Eye', 0, Eye, 2);
    await dd('Nose', 0, Nose, 4);
    await dd('Mouth', 0, Mouth, 5);
    await dd('Hat', 0, Hat, 1);
    //$('#traits').append(txt.substring(0, txt.length - 1) + ']}');
    cnt++;
  }
  function ran(p) {
    return Math.floor(Math.random() * p);
  }
  async function start() {
    for (i = 0; i < 500; i++) await load();
  }
  start();
</script>
